<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Å∂„ÅÑ„Åô„ÅΩ„Å£ÔºÅ„Ç≥„Çπ„Éó„É¨„Ç¢„Éº„Ç´„Ç§„Éñ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- Â§âÊï∞ÂÆöÁæ© (Light/Dark) --- */
        :root { 
            --primary: #5c6ac4; --primary-dark: #4653a1;
            --bg: #f4f6f8; --card-bg: #ffffff; --text: #333; --text-sub: #666;
            --border: #ddd; --modal-bg: rgba(0,0,0,0.85);
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        body.dark-mode {
            --bg: #1a1a2e; --card-bg: #16213e; --text: #e0e0e0; --text-sub: #a0a0a0;
            --border: #2c3e50; --shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
        
        header { background: var(--primary); color: #fff; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        h1 { margin: 0; font-size: 1.4rem; letter-spacing: 1px; }
        
        .theme-switch { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: #fff; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 1.2rem; }
        .tools-container { max-width: 700px; margin: 15px auto 0; display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; align-items: center; }
        .search-input { flex: 1; padding: 10px 15px; border-radius: 20px; border: none; outline: none; min-width: 200px; }
        .tool-btn { background: rgba(255,255,255,0.2); border: none; color: #fff; padding: 8px 12px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; white-space: nowrap; }
        .tool-btn.active { background: #fff; color: var(--primary); font-weight: bold; }

        nav { display: flex; justify-content: center; gap: 10px; padding: 20px; }
        .btn-view { background: var(--card-bg); color: var(--primary); border: 1px solid var(--primary); padding: 8px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
        .btn-view.active { background: var(--primary); color: #fff; }

        main { max-width: 1200px; margin: 0 auto; padding: 0 20px 60px; }
        .section-title { width: 100%; border-bottom: 2px solid var(--border); margin: 40px 0 20px; padding-bottom: 8px; font-size: 1.2rem; color: var(--primary); font-weight: bold; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        
        .card { background: var(--card-bg); border-radius: 12px; overflow: hidden; box-shadow: var(--shadow); cursor: pointer; transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
        .card-img-box { width: 100%; height: 250px; background: #333; overflow: hidden; position: relative; }
        .card-img-box img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-info { padding: 12px; }
        .tag-member { display: inline-block; background: #e3f2fd; color: #1565c0; padding: 3px 10px; border-radius: 10px; font-size: 0.75rem; margin-bottom: 5px; }
        .cos-name { font-weight: bold; font-size: 1rem; margin-bottom: 5px; color: var(--text); }
        
        /* „É¢„Éº„ÉÄ„É´ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--modal-bg); z-index: 1000; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal.open { display: flex; opacity: 1; }
        .modal-content { max-width: 90%; max-height: 90%; position: relative; text-align: center; }
        .modal-img { max-width: 100%; max-height: 80vh; border-radius: 8px; }
        .modal-info { margin-top: 15px; color: #fff; }
        .modal-link-btn { display: inline-block; background: #1da1f2; color: white; padding: 10px 20px; border-radius: 30px; text-decoration: none; margin-top: 10px; font-weight: bold; }
        .modal-close { position: absolute; top: -40px; right: 0; color: #fff; font-size: 2rem; cursor: pointer; }

        .loading { text-align: center; padding: 50px; color: var(--text-sub); }
        #scrollTopBtn { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: #fff; border: none; padding: 15px; border-radius: 50%; cursor: pointer; display: none; z-index: 90; }
    </style>
</head>
<body>

<header>
    <h1>üëò VSPO! Cosplay Archive</h1>
    <button class="theme-switch" onclick="toggleTheme()"><i class="fas fa-moon"></i></button>

    <div class="tools-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Ê§úÁ¥¢..." oninput="handleSearch()">
        <button class="tool-btn active" id="btn-new" onclick="sortData('new')"><i class="fas fa-sort-amount-down"></i> Êñ∞ÁùÄÈ†Ü</button>
        <button class="tool-btn" id="btn-original" onclick="sortData('original')"><i class="fas fa-sort-numeric-down"></i> ÁôªÈå≤È†Ü</button>
        <button class="tool-btn" id="btn-shuffle" onclick="sortData('shuffle')"><i class="fas fa-random"></i> „Ç∑„É£„ÉÉ„Éï„É´</button>
    </div>
</header>

<nav>
    <button class="btn-view active" onclick="switchView('member')">„É°„É≥„Éê„ÉºÂà•</button>
    <button class="btn-view" onclick="switchView('cosplayer')">„É¨„Ç§„É§„ÉºÂà•</button>
</nav>

<main>
    <div id="content-area"></div>
</main>

<button id="scrollTopBtn" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>

<div id="modal" class="modal" onclick="closeModal(event)">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <img id="modalImg" class="modal-img" src="" alt="">
        <div class="modal-info">
            <h3 id="modalTitle"></h3>
            <a id="modalLink" href="#" target="_blank" class="modal-link-btn">ÂÖÉ„ÅÆÊäïÁ®ø„ÇíË¶ã„Çã</a>
        </div>
    </div>
</div>

<script>
    // ‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº‚ñº
    // „Åì„Åì„Å´URL„ÇíË≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ
    const API_URL = "https://script.google.com/macros/s/AKfycbxvb3zcpHRMQDJgq0Ngk92cBG3bXWRMSWVBtKg17CB93xSbuTimDj_5p1Lkq4B5wH2q/exec"; 
    // ‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤‚ñ≤

    let allData = [];
    let filteredData = [];
    let currentMode = 'member'; 
    let currentSort = 'new'; 

    fetchData();
    checkTheme();

    async function fetchData() {
        const container = document.getElementById('content-area');
        container.innerHTML = '<div class="loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>';
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            
            // „ÄêË®∫Êñ≠Áî®„Éù„ÉÉ„Éó„Ç¢„ÉÉ„Éó„Äë
            // „Åì„Çå„ÅåË°®Á§∫„Åï„Çå„Çå„Å∞ÈÄö‰ø°„ÅØÊàêÂäü„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ0‰ª∂„Å™„ÇâGASÂÅ¥„ÅÆÂïèÈ°å„ÄÅ‰ª∂Êï∞„Åå„ÅÇ„Çå„Å∞HTMLÂÅ¥„ÅÆÂïèÈ°å„Åß„Åô„ÄÇ
            alert("„ÄêË®∫Êñ≠„Äë\n„Éá„Éº„ÇøÂèó‰ø°‰ª∂Êï∞: " + data.length + "‰ª∂\n\n(OK„ÇíÊäº„Åô„Å®Ë°®Á§∫Âá¶ÁêÜ„Å´ÈÄ≤„Åø„Åæ„Åô)");

            allData = data.map((item, index) => {
                if(!item.id) item.id = index;
                return item;
            });

            sortData('new'); 
        } catch (e) {
            console.error(e);
            alert("ÈÄö‰ø°„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: " + e.message);
            container.innerHTML = '<p style="text-align:center; color:red;">Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº<br>API_URL„ÅåÊ≠£„Åó„ÅÑ„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>';
        }
    }

    function render() {
        const container = document.getElementById('content-area');
        container.innerHTML = '';
        
        if(filteredData.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#666; margin-top:50px;">„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</p>';
            return;
        }

        const key = currentMode === 'member' ? 'member' : 'cosplayer';
        const groups = {};
        
        filteredData.forEach(item => {
            // ‚òÖÈáçË¶ÅÔºö„Åì„Åì„Åß„ÄåÁîªÂÉè„Åå„Å™„ÅÑ„Éá„Éº„Çø„Äç„ÇÇË®±ÂèØ„Åô„Çã„Çà„ÅÜ„Å´„Éï„Ç£„É´„Çø„Éº„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü
            
            // „Ç∞„É´„Éº„ÉóÂêç„ÅåÁ©∫„Å™„Çâ„ÄåÊú™ÂàÜÈ°û„Äç
            const groupKey = item[key] || "Êú™ÂàÜÈ°û";

            if (!groups[groupKey]) groups[groupKey] = [];
            groups[groupKey].push(item);
        });

        Object.keys(groups).forEach(groupName => {
            const section = document.createElement('div');
            section.innerHTML = `<div class="section-title">‚ñ† ${groupName}</div>`;
            
            let gridHtml = '<div class="grid">';
            groups[groupName].forEach(item => {
                const safeMember = item.member || "ÂêçÂâç„Å™„Åó";
                const safeCos = item.cosplayer || "„É¨„Ç§„É§„ÉºÂêç„Å™„Åó";
                const safeImg = item.image || "https://placehold.jp/300x300.png?text=No+Image";
                const safeLink = item.link || "#";

                const escMember = safeMember.replace(/'/g, "\\'");
                const escCos = safeCos.replace(/'/g, "\\'");
                
                gridHtml += `
                    <div class="card" onclick="openModal('${safeImg}', '${escMember}', '${escCos}', '${safeLink}')">
                        <div class="card-img-box">
                            <img src="${safeImg}" loading="lazy" alt="cosplay" onerror="this.src='https://placehold.jp/300x300.png?text=Image+Error'">
                        </div>
                        <div class="card-info">
                            <span class="tag-member">${safeMember}</span>
                            <div class="cos-name">${safeCos}</div>
                        </div>
                    </div>
                `;
            });
            gridHtml += '</div>';
            section.innerHTML += gridHtml;
            container.appendChild(section);
        });
    }

    function handleSearch() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        const keywords = keyword.split(/\s+/);
        filteredData = allData.filter(item => {
            const text = ((item.member||"") + (item.cosplayer||"")).toLowerCase();
            return keywords.every(k => text.includes(k));
        });
        applySort(currentSort);
    }

    function sortData(type) {
        currentSort = type;
        document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
        if(document.getElementById('btn-' + type)) {
            document.getElementById('btn-' + type).classList.add('active');
        }
        applySort(type);
    }

    function applySort(type) {
        if (type === 'new') filteredData.sort((a, b) => b.id - a.id);
        else if (type === 'original') filteredData.sort((a, b) => a.id - b.id);
        else if (type === 'shuffle') filteredData.sort(() => Math.random() - 0.5);
        render();
    }

    function switchView(mode) {
        currentMode = mode;
        document.querySelectorAll('.btn-view').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        render();
    }

    function openModal(img, member, cosplayer, link) {
        const modal = document.getElementById('modal');
        document.getElementById('modalImg').src = img;
        document.getElementById('modalTitle').innerText = `${member} / ${cosplayer}`;
        document.getElementById('modalLink').href = link;
        modal.classList.add('open');
        document.body.style.overflow = 'hidden'; 
    }

    function closeModal(e) {
        if (e.target.id === 'modal' || e.target.classList.contains('modal-close')) {
            document.getElementById('modal').classList.remove('open');
            document.body.style.overflow = ''; 
        }
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
    }

    function checkTheme() {
        if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
    }

    window.onscroll = function() {
        const btn = document.getElementById('scrollTopBtn');
        if (btn) btn.style.display = (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) ? "block" : "none";
    };
    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>

</body>
</html>
