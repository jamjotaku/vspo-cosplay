<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã¶ã„ã™ã½ã£ï¼ã‚³ã‚¹ãƒ—ãƒ¬ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</title>
    <style>
        /* --- ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š --- */
        :root { --primary: #5c6ac4; --bg: #f4f6f8; --white: #ffffff; --text: #333; --danger: #e74c3c; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; }
        
        header { background: var(--primary); color: var(--white); padding: 20px; text-align: center; }
        h1 { margin: 0; font-size: 1.5rem; }
        .guideline-alert { background: #fff3cd; color: #856404; padding: 10px; font-size: 0.85rem; text-align: center; border-bottom: 1px solid #ffeeba; }

        nav { display: flex; justify-content: center; gap: 10px; padding: 20px; }
        button { padding: 10px 20px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .btn-view { background: var(--white); color: var(--primary); border: 1px solid var(--primary); }
        .btn-view:hover, .btn-view.active { background: var(--primary); color: var(--white); }

        main { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section-title { width: 100%; border-bottom: 2px solid #ddd; margin: 40px 0 20px 0; padding-bottom: 5px; font-size: 1.2rem; color: var(--primary); font-weight: bold; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        
        .card { background: var(--white); border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .card:hover { transform: translateY(-3px); }
        .card-img-box { width: 100%; height: 250px; background: #eee; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .card-img-box img { width: 100%; height: 100%; object-fit: cover; }
        
        .card-info { padding: 15px; }
        .tag-member { display: inline-block; background: #e3f2fd; color: #1565c0; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-bottom: 5px; }
        .cos-name { font-weight: bold; font-size: 1rem; margin-bottom: 5px; }
        .source-link { font-size: 0.85rem; color: var(--primary); text-decoration: none; display: block; margin-top: 10px; }

        .loading { text-align: center; margin-top: 50px; color: #666; font-size: 1.2rem; }
        .error-msg { text-align: center; color: var(--danger); margin-top: 30px; }
    </style>
</head>
<body>

<div class="guideline-alert">
    â€»æœ¬ã‚µã‚¤ãƒˆã¯éå…¬å¼ã®ãƒ•ã‚¡ãƒ³ã‚µã‚¤ãƒˆã§ã™ã€‚ã¶ã„ã™ã½ã£ï¼äºŒæ¬¡å‰µä½œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«åŸºã¥ãã€åç›ŠåŒ–ã¯è¡Œã£ã¦ã„ã¾ã›ã‚“ã€‚<br>
    ãƒ‡ãƒ¼ã‚¿ã¯Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚
</div>

<header>
    <h1>ğŸ‘˜ ã¶ã„ã™ã½ã£ï¼ Cosplay Archive</h1>
</header>

<nav>
    <button class="btn-view active" onclick="switchView('member')">ãƒ¡ãƒ³ãƒãƒ¼åˆ¥</button>
    <button class="btn-view" onclick="switchView('cosplayer')">ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥</button>
</nav>

<main>
    <div id="content-area"></div>
</main>

<script>
    // ==========================================
    // â–¼ è¨­å®šã•ã‚ŒãŸGASã®URL â–¼
    const API_URL = "https://script.google.com/macros/s/AKfycbxvb3zcpHRMQDJgq0Ngk92cBG3bXWRMSWVBtKg17CB93xSbuTimDj_5p1Lkq4B5wH2q/exec"; 
    // ==========================================

    let cosplayData = [];
    let currentMode = 'member'; 

    // èµ·å‹•æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
    fetchData();

    async function fetchData() {
        const container = document.getElementById('content-area');
        container.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...<br>â³</div>';

        try {
            // Google Apps Scriptã‹ã‚‰ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è¿½è·¡ã—ã¦å–å¾—
            const response = await fetch(API_URL);
            
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }

            cosplayData = await response.json();
            render();
        } catch (error) {
            console.error(error);
            container.innerHTML = `
                <div class="error-msg">
                    ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚<br>
                    <small>â€»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šãŒã€Œå…¨å“¡(Anyone)ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</small>
                </div>`;
        }
    }

    function switchView(mode) {
        currentMode = mode;
        // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.btn-view').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        render();
    }

    function render() {
        const container = document.getElementById('content-area');
        container.innerHTML = '';

        if (!Array.isArray(cosplayData) || cosplayData.length === 0) {
            container.innerHTML = '<p style="text-align:center; margin-top:50px;">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚</p>';
            return;
        }

        const key = currentMode === 'member' ? 'member' : 'cosplayer';
        
        // ã‚°ãƒ«ãƒ¼ãƒ—åŒ–å‡¦ç†
        const groups = {};
        cosplayData.forEach(item => {
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ç©ºè¡Œå¯¾ç­–
            if(!item.member) return;

            if (!groups[item[key]]) { groups[item[key]] = []; }
            groups[item[key]].push(item);
        });

        // HTMLç”Ÿæˆ
        Object.keys(groups).forEach(groupName => {
            const section = document.createElement('div');
            const titleHtml = `<div class="section-title">â–  ${groupName}</div>`;
            
            let gridHtml = '<div class="grid">';
            groups[groupName].forEach(item => {
                gridHtml += `
                    <div class="card">
                        <a href="${item.link}" target="_blank" style="text-decoration:none; color:inherit;">
                            <div class="card-img-box">
                                <img src="${item.image}" alt="cosplay" onerror="this.src='https://placehold.jp/300x200.png?text=No+Image'">
                            </div>
                            <div class="card-info">
                                <span class="tag-member">${item.member}</span>
                                <div class="cos-name">${item.cosplayer}</div>
                                <span class="source-link">ğŸ”— å…ƒã®æŠ•ç¨¿ã‚’è¦‹ã‚‹</span>
                            </div>
                        </a>
                    </div>
                `;
            });
            gridHtml += '</div>';
            section.innerHTML = titleHtml + gridHtml;
            container.appendChild(section);
        });
    }
</script>

</body>
</html>